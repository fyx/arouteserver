# built by ARouteServer
AS 64496
router-id 192.0.2.1

fib-update no
log updates

nexthop qualify via default

rde evaluate all

INTCOMM_PREF_OK_ROA="soo 65535:1"
INTCOMM_ROUTE_OK_WL="soo 65535:2"
INTCOMM_PREF_OK_ARINDB="soo 65535:3"
INTCOMM_PREF_OK_REGISTROBRDB="soo 65535:12"

INTCOMM_ORIGIN_OK="soo 65535:4"
INTCOMM_ORIGIN_KO="soo 65535:5"
INTCOMM_PREFIX_OK="soo 65535:6"
INTCOMM_PREFIX_KO="soo 65535:7"
INTCOMM_IRR_REJECT="soo 65535:8"

INTCOMM_RPKI_UNKNOWN="soo 65535:9"
INTCOMM_RPKI_INVALID="soo 65535:10"
INTCOMM_RPKI_VALID="soo 65535:11"

INTCOMM_PROCESS_PREPEND_COMMS="soo 65535:13"

INTCOMM_NO_EXPORT="soo 65535:65281"
INTCOMM_NO_ADVERTISE="soo 65535:65282"

# ---------------------------------------------------------
# IRRDB

# AS3333, used by client AS3333_1
as-set "AS_SET_AS3333_asns" {
    3333
}
prefix-set "AS_SET_AS3333_prefixes" {
    193.0.0.0/21 prefixlen 21 - 32
    193.0.10.0/23 prefixlen 23 - 32
    193.0.12.0/23 prefixlen 23 - 32
    193.0.18.0/23 prefixlen 23 - 32
    193.0.20.0/22 prefixlen 23 - 32
    2001:67c:2e8::/48 prefixlen 48 - 128
}

# AS65551, used by client AS65551_1
as-set "AS_SET_AS65551_asns" {
    65551
}
# no prefixes found for AS65551

# AS10745, used by client AS10745_1, client AS10745_2
as-set "AS_SET_AS10745_asns" {
    10745
}
prefix-set "AS_SET_AS10745_prefixes" {
    192.136.136.0/24 prefixlen 24 - 32
    192.149.252.0/24 prefixlen 24 - 32
    199.43.0.0/24 prefixlen 24 - 32
    2001:500:4::/48 prefixlen 48 - 128
    2001:500:110::/48 prefixlen 48 - 128
}

# AS-RIPENCC, used by client AS3333_1
as-set "AS_SET_AS_RIPENCC_asns" {
    2121 3333 12654
}
prefix-set "AS_SET_AS_RIPENCC_prefixes" {
    23.128.24.0/24 prefixlen 24 - 32
    27.50.0.0/22 prefixlen 22 - 32
    39.0.1.0/24 prefixlen 24 - 32
    84.205.64.0/22 prefixlen 24 - 32
    84.205.69.0/24 prefixlen 24 - 32
    84.205.70.0/24 prefixlen 24 - 32
    84.205.74.0/23 prefixlen 24 - 32
    84.205.76.0/24 prefixlen 24 - 32
    84.205.79.0/24 prefixlen 24 - 32
    84.205.80.0/22 prefixlen 24 - 32
    84.205.85.0/24 prefixlen 24 - 32
    84.205.86.0/24 prefixlen 24 - 32
    84.205.88.0/24 prefixlen 24 - 32
    84.205.90.0/23 prefixlen 24 - 32
    84.205.92.0/24 prefixlen 24 - 32
    84.205.95.0/24 prefixlen 24 - 32
    93.175.144.0/24 prefixlen 24 - 32
    93.175.146.0/24 prefixlen 24 - 32
    93.175.152.0/23 prefixlen 24 - 32
    93.175.154.0/25 prefixlen 25 - 32
    93.175.154.128/28 prefixlen 28 - 32
    103.1.0.0/22 prefixlen 22 - 32
    103.1.4.0/24 prefixlen 24 - 32
    106.0.1.0/24 prefixlen 24 - 32
    193.0.0.0/21 prefixlen 21 - 32
    193.0.10.0/23 prefixlen 23 - 32
    193.0.12.0/23 prefixlen 23 - 32
    193.0.18.0/23 prefixlen 23 - 32
    193.0.20.0/22 prefixlen 23 - 32
    193.0.24.0/21 prefixlen 21 - 32
    2001:67c:64::/48 prefixlen 48 - 128
    2001:67c:2e8::/48 prefixlen 48 - 128
    2001:7fb:ee00::/46 prefixlen 48 - 128
    2001:7fb:ee04::/47 prefixlen 48 - 128
    2001:7fb:ef00::/46 prefixlen 48 - 128
    2001:7fb:ef04::/47 prefixlen 48 - 128
    2001:7fb:fb01:100::/56 prefixlen 56 - 128
    2001:7fb:fb01:200::/64 prefixlen 64 - 128
    2001:7fb:fd02::/48 prefixlen 48 - 128
    2001:7fb:fd04::/47 prefixlen 48 - 128
    2001:7fb:fe00::/45 prefixlen 48 - 128
    2001:7fb:fe0a::/47 prefixlen 48 - 128
    2001:7fb:fe0c::/46 prefixlen 48 - 128
    2001:7fb:fe10::/48 prefixlen 48 - 128
    2001:7fb:fe12::/47 prefixlen 48 - 128
    2001:7fb:fe14::/46 prefixlen 48 - 128
    2001:7fb:fe18::/47 prefixlen 48 - 128
    2001:7fb:fe20::/48 prefixlen 48 - 128
    2001:7fb:ff00::/45 prefixlen 48 - 128
    2001:7fb:ff0a::/47 prefixlen 48 - 128
    2001:7fb:ff0c::/46 prefixlen 48 - 128
    2001:7fb:ff10::/48 prefixlen 48 - 128
    2001:7fb:ff12::/47 prefixlen 48 - 128
    2001:7fb:ff14::/46 prefixlen 48 - 128
    2001:7fb:ff18::/47 prefixlen 48 - 128
    2001:7fb:ff20::/48 prefixlen 48 - 128
}




# ---------------------------------------------------------
# MEMBERS

group "clients" {

	neighbor 192.0.2.22 {
		remote-as 10745

		rde evaluate all

		passive
		ttl-security no
		max-prefix 121
		transparent-as yes
		enforce neighbor-as no

		role rs
		announce policy yes

		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 2001:db:1:1::22 {
		remote-as 10745

		rde evaluate all

		passive
		ttl-security no
		max-prefix 13915
		transparent-as yes
		enforce neighbor-as no

		role rs
		announce policy yes

		announce as-4byte yes
		announce IPv6 unicast
		announce IPv4 none

		set nexthop no-modify
	}

	neighbor 192.0.2.11 {
		remote-as 3333

		rde evaluate all

		passive
		ttl-security no
		max-prefix 150
		transparent-as yes
		enforce neighbor-as no

		role rs
		announce policy yes

		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 192.0.2.33 {
		remote-as 65551

		rde evaluate all

		passive
		ttl-security no
		max-prefix 170000
		transparent-as yes
		enforce neighbor-as no

		role rs
		announce policy yes

		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}
}



# ---------------------------------------------------------
# FILTERS

# NO_ADVERTISE usage notes.
# The NO_ADVERTISE well-know community is used here to handle
# filters that span over multiple steps. At first it is added
# to any route, then it is removed as filters conditions are
# satisfied. Finally, if it is still present, it means that
# the route should be discarded.




prefix-set "global_black_list_pref" {
    192.0.2.0/24 prefixlen 24 - 32
    2001:db8::/32 prefixlen 32 - 128

}

prefix-set "bogons" {
    0.0.0.0/0
    0.0.0.0/8 prefixlen 8 - 32
    10.0.0.0/8 prefixlen 8 - 32
    127.0.0.0/8 prefixlen 8 - 32
    169.254.0.0/16 prefixlen 16 - 32
    172.16.0.0/12 prefixlen 12 - 32
    192.0.2.0/24 prefixlen 24 - 32
    192.88.99.0/24 prefixlen 24 - 32
    192.168.0.0/16 prefixlen 16 - 32
    198.18.0.0/15 prefixlen 15 - 32
    198.51.100.0/24 prefixlen 24 - 32
    203.0.113.0/24 prefixlen 24 - 32
    224.0.0.0/3 prefixlen 3 - 32
    100.64.0.0/10 prefixlen 10 - 32
    ::/0
    ::/8 prefixlen 8 - 128
    64:ff9b::/96 prefixlen 96 - 128
    100::/8 prefixlen 8 - 128
    200::/7 prefixlen 7 - 128
    400::/6 prefixlen 6 - 128
    800::/5 prefixlen 5 - 128
    1000::/4 prefixlen 4 - 128
    2001::/33 prefixlen 33 - 128
    2001:0:8000::/33 prefixlen 33 - 128
    2001:2::/48 prefixlen 48 - 128
    2001:3::/32 prefixlen 32 - 128
    2001:10::/28 prefixlen 28 - 128
    2001:20::/28 prefixlen 28 - 128
    2001:db8::/32 prefixlen 32 - 128
    2002::/16 prefixlen 16 - 128
    3ffe::/16 prefixlen 16 - 128
    4000::/3 prefixlen 3 - 128
    5f00::/8 prefixlen 8 - 128
    6000::/3 prefixlen 3 - 128
    8000::/3 prefixlen 3 - 128
    a000::/3 prefixlen 3 - 128
    c000::/3 prefixlen 3 - 128
    e000::/4 prefixlen 4 - 128
    f000::/5 prefixlen 5 - 128
    f800::/6 prefixlen 6 - 128
    fc00::/7 prefixlen 7 - 128
    fe80::/10 prefixlen 10 - 128
    fec0::/10 prefixlen 10 - 128
    ff00::/8 prefixlen 8 - 128

}

# never via route-servers ASNs
as-set "neverviarouteserver" {
	46, 92, 174, 278, 680, 714, 1257, 1273, 1299, 1734, 1955, 2119, 2152, 2527, 2603, 2698, 2914, 3257, 3265, 3292, 3320, 3454, 3491, 3630, 3754, 5391, 5432, 5511, 6079, 6405, 6730, 6805, 6830, 6908, 7843, 8075, 8365, 8455, 8607, 8943, 8989, 9908, 9928, 10000, 10013, 11164, 11260, 11290, 11670, 12353, 12389, 12491, 12822, 12926, 13030, 13032, 13631, 14295, 14430, 15305, 15692, 16509, 17012, 17390, 18520, 18914, 20115, 20161, 21396, 21647, 23888, 23961, 24115, 24282, 24800, 25215, 26068, 27947, 28398, 29169, 29695, 30600, 30781, 30967, 30983, 31764, 32598, 32840, 33983, 34108, 34209, 34587, 35836, 35900, 36165, 36459, 36914, 37271, 37529, 38145, 38623, 38713, 39326, 39651, 40063, 42083, 43470, 46450, 46887, 47377, 47584, 48237, 48265, 48408, 49127, 49695, 50576, 50670, 50919, 51530, 51630, 52662, 52990, 53859, 54295, 54574, 56028, 57142, 57433, 57866, 58401, 58768, 59282, 60412, 60449, 60757, 61368, 61525, 62164, 62350, 62467, 62567, 62623, 63126, 63290, 63739, 131398, 131996, 132563, 132829, 132996, 133647, 134022, 135706, 135848, 136106, 136874, 137207, 137610, 138023, 138228, 138368, 138769, 138953, 139667, 140287, 141134, 141411, 141856, 141892, 142164, 142369, 146846, 146958, 149251, 149391, 149587, 149663, 149826, 150242, 151403, 151538, 151633, 151765, 152300, 198250, 199737, 199956, 200558, 201978, 202256, 202351, 202561, 202793, 204482, 206003, 206275, 207195, 207484, 208425, 208753, 209165, 209310, 209810, 210030, 212285, 212512, 212686, 212706, 213202, 215436, 215617, 216047, 216265, 262191, 263127, 263258, 263686, 265630, 266917, 267214, 267561, 267823, 269367, 269906, 270544, 271053, 271172, 272018, 272097, 272124, 273101, 273608, 327732, 328959, 329210, 329253, 393573, 393684, 393731, 394837, 396304, 396477, 397736, 398203, 398296, 398427
}

# =====================================================================================
# Global rules.

# This part of configuration is processed at the beginning of the filters.
# The rules defined in this part are applied to all the clients, and not on a
# client-by-client basis (see the 'match from group clients'), so only global policies
# can be implemented here, that is no client-level configuration are allowed.



# Scrub communities from inbound routes
# origin_not_present_in_as_set
match from group clients set community delete 64512:20
match from group clients set large-community delete 64496:64512:20

# origin_present_in_as_set
match from group clients set community delete 64512:21
match from group clients set large-community delete 64496:64512:21

# prefix_not_present_in_as_set
match from group clients set community delete 64512:10
match from group clients set large-community delete 64496:64512:10

# prefix_present_in_as_set
match from group clients set community delete 64512:11
match from group clients set large-community delete 64496:64512:11

# prefix_validated_via_rpki_roas
match from group clients set community delete 64512:31
match from group clients set large-community delete 64496:64512:31

# reject_cause
match from group clients set community delete 65520:*
match from group clients set large-community delete 64496:65520:*

# reject_cause_map_1
match from group clients set large-community delete 64496:1101:5

# reject_cause_map_10
match from group clients set large-community delete 64496:1101:3

# reject_cause_map_12
match from group clients set large-community delete 64496:1101:9

# reject_cause_map_14
match from group clients set large-community delete 64496:1101:13

# reject_cause_map_2
match from group clients set large-community delete 64496:1101:3

# reject_cause_map_5
match from group clients set large-community delete 64496:1101:8

# reject_cause_map_6
match from group clients set large-community delete 64496:1101:7

# reject_cause_map_7
match from group clients set large-community delete 64496:1101:4

# reject_cause_map_8
match from group clients set large-community delete 64496:1101:14

# reject_cause_map_9
match from group clients set large-community delete 64496:1101:10

# route_validated_via_white_list
match from group clients set community delete 64512:41
match from group clients set large-community delete 64496:64512:41

# rpki_bgp_origin_validation_invalid
match from group clients set community delete 64512:53
match from group clients set large-community delete 64496:1000:4

# rpki_bgp_origin_validation_not_performed
match from group clients set community delete 64512:50
match from group clients set large-community delete 64496:1000:3

# rpki_bgp_origin_validation_unknown
match from group clients set community delete 64512:52
match from group clients set large-community delete 64496:1000:2

# rpki_bgp_origin_validation_valid
match from group clients set community delete 64512:51
match from group clients set large-community delete 64496:1000:1


# Scrub internal communities from inbound routes
match from group clients set {
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



# The main goal of this block is to enrich routes received from clients by attaching to them
# internal informational communities which are used later by the rest of the filter rules.

# Internal communities used for RFC1997 well-known communities handling

# Transform NO_EXPORT into $INTCOMM_NO_EXPORT
match from group clients community NO_EXPORT set { ext-community $INTCOMM_NO_EXPORT community delete NO_EXPORT }

# Transform NO_ADVERTISE into $INTCOMM_NO_ADVERTISE
match from group clients community NO_ADVERTISE set { ext-community $INTCOMM_NO_ADVERTISE community delete NO_ADVERTISE }


# ---------------------------------------------------------
# ROAs source


roa-set {
    193.0.0.0/21 source-as 3333
    193.0.24.0/22 maxlen 26 source-as 3333
    193.0.10.0/23 source-as 3333
    193.0.12.0/23 source-as 3333
    193.0.14.0/23 source-as 25152
    193.0.18.0/23 source-as 3333
    193.0.20.0/23 source-as 3333
    193.0.22.0/23 source-as 3333
    193.0.14.0/24 source-as 25152
    193.0.24.0/24 source-as 3333
    2001:7fd::/32 source-as 25152
    2001:610:240::/42 source-as 3333
    2001:67c:2e8::/48 source-as 3333
    2001:7fd::/48 source-as 25152

}



# ---------------------------------------------------------
# RPKI-based Origin Validation

# Add $INTCOMM_RPKI_UNKNOWN, $INTCOMM_RPKI_INVALID and $INTCOMM_RPKI_VALID
# ext community on the basis of ovs.
match from group clients ovs not-found set {
    ext-community $INTCOMM_RPKI_UNKNOWN
    ext-community ovs not-found
    community 64512:52 large-community 64496:1000:2
}
match from group clients ovs valid set {
    ext-community $INTCOMM_RPKI_VALID
    ext-community ovs valid
    community 64512:51 large-community 64496:1000:1
}
match from group clients ovs invalid set {
    ext-community $INTCOMM_RPKI_INVALID
    ext-community ovs invalid
    community 64512:53 large-community 64496:1000:4
}


# ---------------------------------------------------------
# RPKI ROAs used as route objects.

# Add the $INTCOMM_PREF_OK_ROA ext community to routes whose
# origin ASN has a ROA for the announced prefix.
# It will be used later during IRRDB validation in
# case the origin ASN is authorized by a client's
# AS-SET but the prefix is not.

# Since RPKI-based Origin Validation is already performed above,
# use the origin validation state to identify valid routes.
match from group clients ovs valid set ext-community $INTCOMM_PREF_OK_ROA









# AS_PATH: length
# Reject inbound routes when 'from group clients max-as-len 32' - reject code: 1
# community from reject_cause_map
allow quick from group clients max-as-len 32 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:1 large-community 64496:65520:1
	large-community 64496:1101:5
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Prefix: global blacklist
# Reject inbound routes when 'from group clients prefix-set global_black_list_pref' - reject code: 3
allow quick from group clients prefix-set global_black_list_pref set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:3 large-community 64496:65520:3
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Prefix: only IPv6 Global Unicast space allowed
match from group clients inet6 set community NO_ADVERTISE
match from group clients prefix 2000::/3 or-longer set community delete NO_ADVERTISE
# Reject inbound routes when 'from group clients community NO_ADVERTISE' - reject code: 10
# community from reject_cause_map
allow quick from group clients community NO_ADVERTISE set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:10 large-community 64496:65520:10
	large-community 64496:1101:3
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Prefix: bogon
# Reject inbound routes when 'from group clients prefix-set bogons' - reject code: 2
# community from reject_cause_map
allow quick from group clients prefix-set bogons set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:2 large-community 64496:65520:2
	large-community 64496:1101:3
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}




# =====================================================================================
# Per client rules.


# ---------------------------------------------
# client AS10745_1, inbound



# NEXT_HOP
match from 192.0.2.22 set community NO_ADVERTISE
match from 192.0.2.22 nexthop 192.0.2.22 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.22 community NO_ADVERTISE' - reject code: 5
# community from reject_cause_map
allow quick from 192.0.2.22 community NO_ADVERTISE set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:5 large-community 64496:65520:5
	large-community 64496:1101:8
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 192.0.2.22 peer-as != 10745' - reject code: 6
# community from reject_cause_map
allow quick from 192.0.2.22 peer-as != 10745 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:6 large-community 64496:65520:6
	large-community 64496:1101:7
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 192.0.2.22 AS 23456' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.22 AS 23456 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# Reject inbound routes when 'from 192.0.2.22 AS 64496 - 131071' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.22 AS 64496 - 131071 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# Reject inbound routes when 'from 192.0.2.22 AS 4200000000 - 4294967295' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.22 AS 4200000000 - 4294967295 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: transit-free ASNs
# Reject inbound routes when 'from 192.0.2.22 AS { 174, 701, 1299, 2914, 3257, 3320, 3356, 5511, 6453, 6461, 6762, 6830, 7018, 12956 }' - reject code: 8
# community from reject_cause_map
allow quick from 192.0.2.22 AS { 174, 701, 1299, 2914, 3257, 3320, 3356, 5511, 6453, 6461, 6762, 6830, 7018, 12956 } set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:8 large-community 64496:65520:8
	large-community 64496:1101:14
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: never via route-servers ASNs
# Reject inbound routes when 'from 192.0.2.22 AS as-set neverviarouteserver' - reject code: 15
allow quick from 192.0.2.22 AS as-set neverviarouteserver set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:15 large-community 64496:65520:15
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



match from 192.0.2.22 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS10745_1, AS10745: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.22 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
match from 192.0.2.22 source-as as-set AS_SET_AS10745_asns set {
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community $INTCOMM_ORIGIN_OK
} # AS10745
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.22 ext-community $INTCOMM_ORIGIN_KO set community 64512:20
match from 192.0.2.22 ext-community $INTCOMM_ORIGIN_KO set large-community 64496:64512:20
# adding present_in_as_set community to authorized routes
match from 192.0.2.22 ext-community $INTCOMM_ORIGIN_OK set community 64512:21
match from 192.0.2.22 ext-community $INTCOMM_ORIGIN_OK set large-community 64496:64512:21


# Prefix: check prefix via AS-SET
# IRRDB filters for AS10745_1, AS10745: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.22 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
match from 192.0.2.22 prefix-set AS_SET_AS10745_prefixes set {
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community $INTCOMM_PREFIX_OK
} # AS10745
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.22 ext-community $INTCOMM_PREFIX_KO set community 64512:10
match from 192.0.2.22 ext-community $INTCOMM_PREFIX_KO set large-community 64496:64512:10
# adding present_in_as_set community to authorized routes
match from 192.0.2.22 ext-community $INTCOMM_PREFIX_OK set community 64512:11
match from 192.0.2.22 ext-community $INTCOMM_PREFIX_OK set large-community 64496:64512:11


# routes tagged with $INTCOMM_PREF_OK_ROA community have the prefix validated by a ROA; origin ASN previously validated ($INTCOMM_ORIGIN_OK)
match from 192.0.2.22 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set community 64512:31
match from 192.0.2.22 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set large-community 64496:64512:31

match from 192.0.2.22 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set ext-community delete $INTCOMM_IRR_REJECT




# enforcing: origin ASN
# Reject inbound routes when 'from 192.0.2.22 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_ORIGIN_KO' - reject code: 9
# community from reject_cause_map
allow quick from 192.0.2.22 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_ORIGIN_KO set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:9 large-community 64496:65520:9
	large-community 64496:1101:10
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# enforcing: prefix
# Reject inbound routes when 'from 192.0.2.22 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_PREFIX_KO' - reject code: 12
# community from reject_cause_map
allow quick from 192.0.2.22 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_PREFIX_KO set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:12 large-community 64496:65520:12
	large-community 64496:1101:9
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



# RPKI-based Origin Validation
# Reject inbound routes when 'from 192.0.2.22 ext-community $INTCOMM_RPKI_INVALID' - reject code: 14
# community from reject_cause_map
allow quick from 192.0.2.22 ext-community $INTCOMM_RPKI_INVALID set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:14 large-community 64496:65520:14
	large-community 64496:1101:13
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Prefix: length
# Reject inbound routes when 'from 192.0.2.22 prefix 0.0.0.0/0 prefixlen 8 >< 24' - reject code: 13
allow quick from 192.0.2.22 prefix 0.0.0.0/0 prefixlen 8 >< 24 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:13 large-community 64496:65520:13
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Graceful shutdown
match from 192.0.2.22 community GRACEFUL_SHUTDOWN set localpref 0

# Remove internal communities before accepting the route
match from 192.0.2.22 set {
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}




allow quick from 192.0.2.22



# ---------------------------------------------
# client AS10745_1, outbound

deny quick to 192.0.2.22 community 65520:0
deny quick to 192.0.2.22 large-community 64496:65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 192.0.2.22 community BLACKHOLE


# RPKI-based Origin Validation
# Do not announce INVALID to clients
deny quick to 192.0.2.22 ext-community $INTCOMM_RPKI_INVALID

# NO_EXPORT and NO_ADVERTISE communities
# add_noexport_to_peer
match to 192.0.2.22 community 65281:10745 set community NO_EXPORT
match to 192.0.2.22 large-community 64496:65281:10745 set community NO_EXPORT

# add_noadvertise_to_peer
match to 192.0.2.22 community 65282:10745 set community NO_ADVERTISE
match to 192.0.2.22 large-community 64496:65282:10745 set community NO_ADVERTISE


# BGP control communities
allow to 192.0.2.22

# do_not_announce_to_any
deny to 192.0.2.22 community 0:64496
deny to 192.0.2.22 large-community 64496:0:0

# do_not_announce_to_peer
deny quick to 192.0.2.22 community 0:10745
deny quick to 192.0.2.22 large-community 64496:0:10745

# announce_to_peer
allow to 192.0.2.22 community 64496:10745
allow to 192.0.2.22 large-community 64496:1:10745


# Add the $INTCOMM_PROCESS_PREPEND_COMMS ext community to signal that communities
# for prepending can be processed. As soon as one prepending action is performed,
# this internal community is removed, so that further actions are not processed.
match to 192.0.2.22 set ext-community $INTCOMM_PROCESS_PREPEND_COMMS

# prepend_once_to_peer AS10745; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65511:10745 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:101:10745 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_twice_to_peer AS10745; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65512:10745 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:102:10745 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_thrice_to_peer AS10745; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65513:10745 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:103:10745 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}



# prepend_once_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65501:64496 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:101:0 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_twice_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65502:64496 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:102:0 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_thrice_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65503:64496 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:103:0 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}



# ---------------------------------------------
# client AS10745_2, inbound



# NEXT_HOP
match from 2001:db:1:1::22 set community NO_ADVERTISE
match from 2001:db:1:1::22 nexthop 2001:db:1:1::22 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 2001:db:1:1::22 community NO_ADVERTISE' - reject code: 5
# community from reject_cause_map
allow quick from 2001:db:1:1::22 community NO_ADVERTISE set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:5 large-community 64496:65520:5
	large-community 64496:1101:8
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 2001:db:1:1::22 peer-as != 10745' - reject code: 6
# community from reject_cause_map
allow quick from 2001:db:1:1::22 peer-as != 10745 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:6 large-community 64496:65520:6
	large-community 64496:1101:7
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 2001:db:1:1::22 AS 23456' - reject code: 7
# community from reject_cause_map
allow quick from 2001:db:1:1::22 AS 23456 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# Reject inbound routes when 'from 2001:db:1:1::22 AS 64496 - 131071' - reject code: 7
# community from reject_cause_map
allow quick from 2001:db:1:1::22 AS 64496 - 131071 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# Reject inbound routes when 'from 2001:db:1:1::22 AS 4200000000 - 4294967295' - reject code: 7
# community from reject_cause_map
allow quick from 2001:db:1:1::22 AS 4200000000 - 4294967295 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: transit-free ASNs
# Reject inbound routes when 'from 2001:db:1:1::22 AS { 174, 701, 1299, 2914, 3257, 3320, 3356, 5511, 6453, 6461, 6762, 6830, 7018, 12956 }' - reject code: 8
# community from reject_cause_map
allow quick from 2001:db:1:1::22 AS { 174, 701, 1299, 2914, 3257, 3320, 3356, 5511, 6453, 6461, 6762, 6830, 7018, 12956 } set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:8 large-community 64496:65520:8
	large-community 64496:1101:14
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: never via route-servers ASNs
# Reject inbound routes when 'from 2001:db:1:1::22 AS as-set neverviarouteserver' - reject code: 15
allow quick from 2001:db:1:1::22 AS as-set neverviarouteserver set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:15 large-community 64496:65520:15
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



match from 2001:db:1:1::22 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS10745_2, AS10745: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db:1:1::22 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
match from 2001:db:1:1::22 source-as as-set AS_SET_AS10745_asns set {
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community $INTCOMM_ORIGIN_OK
} # AS10745
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db:1:1::22 ext-community $INTCOMM_ORIGIN_KO set community 64512:20
match from 2001:db:1:1::22 ext-community $INTCOMM_ORIGIN_KO set large-community 64496:64512:20
# adding present_in_as_set community to authorized routes
match from 2001:db:1:1::22 ext-community $INTCOMM_ORIGIN_OK set community 64512:21
match from 2001:db:1:1::22 ext-community $INTCOMM_ORIGIN_OK set large-community 64496:64512:21


# Prefix: check prefix via AS-SET
# IRRDB filters for AS10745_2, AS10745: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db:1:1::22 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
match from 2001:db:1:1::22 prefix-set AS_SET_AS10745_prefixes set {
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community $INTCOMM_PREFIX_OK
} # AS10745
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db:1:1::22 ext-community $INTCOMM_PREFIX_KO set community 64512:10
match from 2001:db:1:1::22 ext-community $INTCOMM_PREFIX_KO set large-community 64496:64512:10
# adding present_in_as_set community to authorized routes
match from 2001:db:1:1::22 ext-community $INTCOMM_PREFIX_OK set community 64512:11
match from 2001:db:1:1::22 ext-community $INTCOMM_PREFIX_OK set large-community 64496:64512:11


# routes tagged with $INTCOMM_PREF_OK_ROA community have the prefix validated by a ROA; origin ASN previously validated ($INTCOMM_ORIGIN_OK)
match from 2001:db:1:1::22 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set community 64512:31
match from 2001:db:1:1::22 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set large-community 64496:64512:31

match from 2001:db:1:1::22 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set ext-community delete $INTCOMM_IRR_REJECT




# enforcing: origin ASN
# Reject inbound routes when 'from 2001:db:1:1::22 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_ORIGIN_KO' - reject code: 9
# community from reject_cause_map
allow quick from 2001:db:1:1::22 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_ORIGIN_KO set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:9 large-community 64496:65520:9
	large-community 64496:1101:10
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# enforcing: prefix
# Reject inbound routes when 'from 2001:db:1:1::22 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_PREFIX_KO' - reject code: 12
# community from reject_cause_map
allow quick from 2001:db:1:1::22 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_PREFIX_KO set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:12 large-community 64496:65520:12
	large-community 64496:1101:9
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



# RPKI-based Origin Validation
# Reject inbound routes when 'from 2001:db:1:1::22 ext-community $INTCOMM_RPKI_INVALID' - reject code: 14
# community from reject_cause_map
allow quick from 2001:db:1:1::22 ext-community $INTCOMM_RPKI_INVALID set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:14 large-community 64496:65520:14
	large-community 64496:1101:13
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Prefix: length
# Reject inbound routes when 'from 2001:db:1:1::22 prefix ::/0 prefixlen 12 >< 48' - reject code: 13
allow quick from 2001:db:1:1::22 prefix ::/0 prefixlen 12 >< 48 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:13 large-community 64496:65520:13
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Graceful shutdown
match from 2001:db:1:1::22 community GRACEFUL_SHUTDOWN set localpref 0

# Remove internal communities before accepting the route
match from 2001:db:1:1::22 set {
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}




allow quick from 2001:db:1:1::22



# ---------------------------------------------
# client AS10745_2, outbound

deny quick to 2001:db:1:1::22 community 65520:0
deny quick to 2001:db:1:1::22 large-community 64496:65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 2001:db:1:1::22 community BLACKHOLE


# RPKI-based Origin Validation
# Do not announce INVALID to clients
deny quick to 2001:db:1:1::22 ext-community $INTCOMM_RPKI_INVALID

# NO_EXPORT and NO_ADVERTISE communities
# add_noexport_to_peer
match to 2001:db:1:1::22 community 65281:10745 set community NO_EXPORT
match to 2001:db:1:1::22 large-community 64496:65281:10745 set community NO_EXPORT

# add_noadvertise_to_peer
match to 2001:db:1:1::22 community 65282:10745 set community NO_ADVERTISE
match to 2001:db:1:1::22 large-community 64496:65282:10745 set community NO_ADVERTISE


# BGP control communities
allow to 2001:db:1:1::22

# do_not_announce_to_any
deny to 2001:db:1:1::22 community 0:64496
deny to 2001:db:1:1::22 large-community 64496:0:0

# do_not_announce_to_peer
deny quick to 2001:db:1:1::22 community 0:10745
deny quick to 2001:db:1:1::22 large-community 64496:0:10745

# announce_to_peer
allow to 2001:db:1:1::22 community 64496:10745
allow to 2001:db:1:1::22 large-community 64496:1:10745


# Add the $INTCOMM_PROCESS_PREPEND_COMMS ext community to signal that communities
# for prepending can be processed. As soon as one prepending action is performed,
# this internal community is removed, so that further actions are not processed.
match to 2001:db:1:1::22 set ext-community $INTCOMM_PROCESS_PREPEND_COMMS

# prepend_once_to_peer AS10745; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65511:10745 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:101:10745 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_twice_to_peer AS10745; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65512:10745 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:102:10745 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_thrice_to_peer AS10745; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65513:10745 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:103:10745 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}



# prepend_once_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65501:64496 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:101:0 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_twice_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65502:64496 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:102:0 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_thrice_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65503:64496 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 2001:db:1:1::22 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:103:0 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}



# ---------------------------------------------
# client AS3333_1, inbound



# NEXT_HOP
match from 192.0.2.11 set community NO_ADVERTISE
match from 192.0.2.11 nexthop 192.0.2.11 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.11 community NO_ADVERTISE' - reject code: 5
# community from reject_cause_map
allow quick from 192.0.2.11 community NO_ADVERTISE set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:5 large-community 64496:65520:5
	large-community 64496:1101:8
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 192.0.2.11 peer-as != 3333' - reject code: 6
# community from reject_cause_map
allow quick from 192.0.2.11 peer-as != 3333 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:6 large-community 64496:65520:6
	large-community 64496:1101:7
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 192.0.2.11 AS 23456' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.11 AS 23456 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# Reject inbound routes when 'from 192.0.2.11 AS 64496 - 131071' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.11 AS 64496 - 131071 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# Reject inbound routes when 'from 192.0.2.11 AS 4200000000 - 4294967295' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.11 AS 4200000000 - 4294967295 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: transit-free ASNs
# Reject inbound routes when 'from 192.0.2.11 AS { 174, 701, 1299, 2914, 3257, 3320, 3356, 5511, 6453, 6461, 6762, 6830, 7018, 12956 }' - reject code: 8
# community from reject_cause_map
allow quick from 192.0.2.11 AS { 174, 701, 1299, 2914, 3257, 3320, 3356, 5511, 6453, 6461, 6762, 6830, 7018, 12956 } set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:8 large-community 64496:65520:8
	large-community 64496:1101:14
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: never via route-servers ASNs
# Reject inbound routes when 'from 192.0.2.11 AS as-set neverviarouteserver' - reject code: 15
allow quick from 192.0.2.11 AS as-set neverviarouteserver set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:15 large-community 64496:65520:15
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



match from 192.0.2.11 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS3333_1, AS3333: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.11 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
match from 192.0.2.11 source-as as-set AS_SET_AS3333_asns set {
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community $INTCOMM_ORIGIN_OK
} # AS3333
match from 192.0.2.11 source-as as-set AS_SET_AS_RIPENCC_asns set {
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community $INTCOMM_ORIGIN_OK
} # AS_RIPENCC
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_KO set community 64512:20
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_KO set large-community 64496:64512:20
# adding present_in_as_set community to authorized routes
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_OK set community 64512:21
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_OK set large-community 64496:64512:21


# Prefix: check prefix via AS-SET
# IRRDB filters for AS3333_1, AS3333: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.11 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
match from 192.0.2.11 prefix-set AS_SET_AS3333_prefixes set {
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community $INTCOMM_PREFIX_OK
} # AS3333
match from 192.0.2.11 prefix-set AS_SET_AS_RIPENCC_prefixes set {
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community $INTCOMM_PREFIX_OK
} # AS_RIPENCC
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.11 ext-community $INTCOMM_PREFIX_KO set community 64512:10
match from 192.0.2.11 ext-community $INTCOMM_PREFIX_KO set large-community 64496:64512:10
# adding present_in_as_set community to authorized routes
match from 192.0.2.11 ext-community $INTCOMM_PREFIX_OK set community 64512:11
match from 192.0.2.11 ext-community $INTCOMM_PREFIX_OK set large-community 64496:64512:11


# routes tagged with $INTCOMM_PREF_OK_ROA community have the prefix validated by a ROA; origin ASN previously validated ($INTCOMM_ORIGIN_OK)
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set community 64512:31
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set large-community 64496:64512:31

match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set ext-community delete $INTCOMM_IRR_REJECT




# enforcing: origin ASN
# Reject inbound routes when 'from 192.0.2.11 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_ORIGIN_KO' - reject code: 9
# community from reject_cause_map
allow quick from 192.0.2.11 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_ORIGIN_KO set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:9 large-community 64496:65520:9
	large-community 64496:1101:10
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# enforcing: prefix
# Reject inbound routes when 'from 192.0.2.11 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_PREFIX_KO' - reject code: 12
# community from reject_cause_map
allow quick from 192.0.2.11 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_PREFIX_KO set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:12 large-community 64496:65520:12
	large-community 64496:1101:9
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



# RPKI-based Origin Validation
# Reject inbound routes when 'from 192.0.2.11 ext-community $INTCOMM_RPKI_INVALID' - reject code: 14
# community from reject_cause_map
allow quick from 192.0.2.11 ext-community $INTCOMM_RPKI_INVALID set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:14 large-community 64496:65520:14
	large-community 64496:1101:13
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Prefix: length
# Reject inbound routes when 'from 192.0.2.11 prefix 0.0.0.0/0 prefixlen 8 >< 24' - reject code: 13
allow quick from 192.0.2.11 prefix 0.0.0.0/0 prefixlen 8 >< 24 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:13 large-community 64496:65520:13
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Graceful shutdown
match from 192.0.2.11 community GRACEFUL_SHUTDOWN set localpref 0

# Remove internal communities before accepting the route
match from 192.0.2.11 set {
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}




allow quick from 192.0.2.11



# ---------------------------------------------
# client AS3333_1, outbound

deny quick to 192.0.2.11 community 65520:0
deny quick to 192.0.2.11 large-community 64496:65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 192.0.2.11 community BLACKHOLE


# RPKI-based Origin Validation
# Do not announce INVALID to clients
deny quick to 192.0.2.11 ext-community $INTCOMM_RPKI_INVALID

# NO_EXPORT and NO_ADVERTISE communities
# add_noexport_to_peer
match to 192.0.2.11 community 65281:3333 set community NO_EXPORT
match to 192.0.2.11 large-community 64496:65281:3333 set community NO_EXPORT

# add_noadvertise_to_peer
match to 192.0.2.11 community 65282:3333 set community NO_ADVERTISE
match to 192.0.2.11 large-community 64496:65282:3333 set community NO_ADVERTISE


# BGP control communities
allow to 192.0.2.11

# do_not_announce_to_any
deny to 192.0.2.11 community 0:64496
deny to 192.0.2.11 large-community 64496:0:0

# do_not_announce_to_peer
deny quick to 192.0.2.11 community 0:3333
deny quick to 192.0.2.11 large-community 64496:0:3333

# announce_to_peer
allow to 192.0.2.11 community 64496:3333
allow to 192.0.2.11 large-community 64496:1:3333


# Add the $INTCOMM_PROCESS_PREPEND_COMMS ext community to signal that communities
# for prepending can be processed. As soon as one prepending action is performed,
# this internal community is removed, so that further actions are not processed.
match to 192.0.2.11 set ext-community $INTCOMM_PROCESS_PREPEND_COMMS

# prepend_once_to_peer AS3333; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65511:3333 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:101:3333 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_twice_to_peer AS3333; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65512:3333 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:102:3333 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_thrice_to_peer AS3333; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65513:3333 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:103:3333 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}



# prepend_once_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65501:64496 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:101:0 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_twice_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65502:64496 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:102:0 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_thrice_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65503:64496 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.11 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:103:0 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}



# ---------------------------------------------
# client AS65551_1, inbound



# NEXT_HOP
match from 192.0.2.33 set community NO_ADVERTISE
match from 192.0.2.33 nexthop 192.0.2.33 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.33 community NO_ADVERTISE' - reject code: 5
# community from reject_cause_map
allow quick from 192.0.2.33 community NO_ADVERTISE set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:5 large-community 64496:65520:5
	large-community 64496:1101:8
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 192.0.2.33 peer-as != 65551' - reject code: 6
# community from reject_cause_map
allow quick from 192.0.2.33 peer-as != 65551 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:6 large-community 64496:65520:6
	large-community 64496:1101:7
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 192.0.2.33 AS 23456' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.33 AS 23456 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# Reject inbound routes when 'from 192.0.2.33 AS 64496 - 131071' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.33 AS 64496 - 131071 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# Reject inbound routes when 'from 192.0.2.33 AS 4200000000 - 4294967295' - reject code: 7
# community from reject_cause_map
allow quick from 192.0.2.33 AS 4200000000 - 4294967295 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:7 large-community 64496:65520:7
	large-community 64496:1101:4
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: transit-free ASNs
# Reject inbound routes when 'from 192.0.2.33 AS { 174, 701, 1299, 2914, 3257, 3320, 3356, 5511, 6453, 6461, 6762, 6830, 7018, 12956 }' - reject code: 8
# community from reject_cause_map
allow quick from 192.0.2.33 AS { 174, 701, 1299, 2914, 3257, 3320, 3356, 5511, 6453, 6461, 6762, 6830, 7018, 12956 } set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:8 large-community 64496:65520:8
	large-community 64496:1101:14
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# AS_PATH: never via route-servers ASNs
# Reject inbound routes when 'from 192.0.2.33 AS as-set neverviarouteserver' - reject code: 15
allow quick from 192.0.2.33 AS as-set neverviarouteserver set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:15 large-community 64496:65520:15
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



match from 192.0.2.33 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS65551_1, AS65551: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.33 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
match from 192.0.2.33 source-as as-set AS_SET_AS65551_asns set {
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community $INTCOMM_ORIGIN_OK
} # AS65551
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.33 ext-community $INTCOMM_ORIGIN_KO set community 64512:20
match from 192.0.2.33 ext-community $INTCOMM_ORIGIN_KO set large-community 64496:64512:20
# adding present_in_as_set community to authorized routes
match from 192.0.2.33 ext-community $INTCOMM_ORIGIN_OK set community 64512:21
match from 192.0.2.33 ext-community $INTCOMM_ORIGIN_OK set large-community 64496:64512:21


# Prefix: check prefix via AS-SET
# IRRDB filters for AS65551_1, AS65551: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.33 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS65551 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.33 ext-community $INTCOMM_PREFIX_KO set community 64512:10
match from 192.0.2.33 ext-community $INTCOMM_PREFIX_KO set large-community 64496:64512:10
# adding present_in_as_set community to authorized routes
match from 192.0.2.33 ext-community $INTCOMM_PREFIX_OK set community 64512:11
match from 192.0.2.33 ext-community $INTCOMM_PREFIX_OK set large-community 64496:64512:11


# routes tagged with $INTCOMM_PREF_OK_ROA community have the prefix validated by a ROA; origin ASN previously validated ($INTCOMM_ORIGIN_OK)
match from 192.0.2.33 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set community 64512:31
match from 192.0.2.33 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set large-community 64496:64512:31

match from 192.0.2.33 ext-community $INTCOMM_ORIGIN_OK ext-community $INTCOMM_PREF_OK_ROA set ext-community delete $INTCOMM_IRR_REJECT




# enforcing: origin ASN
# Reject inbound routes when 'from 192.0.2.33 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_ORIGIN_KO' - reject code: 9
# community from reject_cause_map
allow quick from 192.0.2.33 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_ORIGIN_KO set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:9 large-community 64496:65520:9
	large-community 64496:1101:10
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}

# enforcing: prefix
# Reject inbound routes when 'from 192.0.2.33 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_PREFIX_KO' - reject code: 12
# community from reject_cause_map
allow quick from 192.0.2.33 ext-community $INTCOMM_IRR_REJECT ext-community $INTCOMM_PREFIX_KO set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:12 large-community 64496:65520:12
	large-community 64496:1101:9
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}



# RPKI-based Origin Validation
# Reject inbound routes when 'from 192.0.2.33 ext-community $INTCOMM_RPKI_INVALID' - reject code: 14
# community from reject_cause_map
allow quick from 192.0.2.33 ext-community $INTCOMM_RPKI_INVALID set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:14 large-community 64496:65520:14
	large-community 64496:1101:13
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Prefix: length
# Reject inbound routes when 'from 192.0.2.33 prefix 0.0.0.0/0 prefixlen 8 >< 24' - reject code: 13
allow quick from 192.0.2.33 prefix 0.0.0.0/0 prefixlen 8 >< 24 set {
	localpref 1
	community 65520:0 large-community 64496:65520:0
	community 65520:13 large-community 64496:65520:13
	community delete NO_ADVERTISE
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


# Graceful shutdown
match from 192.0.2.33 community GRACEFUL_SHUTDOWN set localpref 0

# Remove internal communities before accepting the route
match from 192.0.2.33 set {
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}




allow quick from 192.0.2.33



# ---------------------------------------------
# client AS65551_1, outbound

deny quick to 192.0.2.33 community 65520:0
deny quick to 192.0.2.33 large-community 64496:65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 192.0.2.33 community BLACKHOLE


# RPKI-based Origin Validation
# Do not announce INVALID to clients
deny quick to 192.0.2.33 ext-community $INTCOMM_RPKI_INVALID

# NO_EXPORT and NO_ADVERTISE communities
# add_noexport_to_peer
# 64512 is the 16bit_mapped_asn for 65551
match to 192.0.2.33 community 65281:64512 set community NO_EXPORT
match to 192.0.2.33 large-community 64496:65281:65551 set community NO_EXPORT

# add_noadvertise_to_peer
# 64512 is the 16bit_mapped_asn for 65551
match to 192.0.2.33 community 65282:64512 set community NO_ADVERTISE
match to 192.0.2.33 large-community 64496:65282:65551 set community NO_ADVERTISE


# BGP control communities
allow to 192.0.2.33

# do_not_announce_to_any
deny to 192.0.2.33 community 0:64496
deny to 192.0.2.33 large-community 64496:0:0

# do_not_announce_to_peer
# 64512 is the 16bit_mapped_asn for 65551
deny quick to 192.0.2.33 community 0:64512
deny quick to 192.0.2.33 large-community 64496:0:65551

# announce_to_peer
# 64512 is the 16bit_mapped_asn for 65551
allow to 192.0.2.33 community 64496:64512
allow to 192.0.2.33 large-community 64496:1:65551


# Add the $INTCOMM_PROCESS_PREPEND_COMMS ext community to signal that communities
# for prepending can be processed. As soon as one prepending action is performed,
# this internal community is removed, so that further actions are not processed.
match to 192.0.2.33 set ext-community $INTCOMM_PROCESS_PREPEND_COMMS

# prepend_once_to_peer AS65551; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
# 64512 is the 16bit_mapped_asn for 65551
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65511:64512 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:101:65551 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_twice_to_peer AS65551; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
# 64512 is the 16bit_mapped_asn for 65551
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65512:64512 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:102:65551 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_thrice_to_peer AS65551; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
# 64512 is the 16bit_mapped_asn for 65551
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65513:64512 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:103:65551 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}



# prepend_once_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65501:64496 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:101:0 set {
	prepend-neighbor 1
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_twice_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65502:64496 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:102:0 set {
	prepend-neighbor 2
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}

# prepend_thrice_to_any; remove INTCOMM_PROCESS_PREPEND_COMMS to prevent further prepending actions
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS community 65503:64496 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}
match to 192.0.2.33 ext-community $INTCOMM_PROCESS_PREPEND_COMMS large-community 64496:103:0 set {
	prepend-neighbor 3
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS
}





# Scrub communities from outbound routes
# add_noadvertise_to_peer
match to group clients set community delete 65282:*
match to group clients set large-community delete 64496:65282:*

# add_noexport_to_peer
match to group clients set community delete 65281:*
match to group clients set large-community delete 64496:65281:*

# announce_to_peer
match to group clients set community delete 64496:*
match to group clients set large-community delete 64496:1:*

# do_not_announce_to_any
match to group clients set community delete 0:64496
match to group clients set large-community delete 64496:0:0

# do_not_announce_to_peer
match to group clients set community delete 0:*
match to group clients set large-community delete 64496:0:*

# prepend_once_to_any
match to group clients set community delete 65501:64496
match to group clients set large-community delete 64496:101:0

# prepend_once_to_peer
match to group clients set community delete 65511:*
match to group clients set large-community delete 64496:101:*

# prepend_thrice_to_any
match to group clients set community delete 65503:64496
match to group clients set large-community delete 64496:103:0

# prepend_thrice_to_peer
match to group clients set community delete 65513:*
match to group clients set large-community delete 64496:103:*

# prepend_twice_to_any
match to group clients set community delete 65502:64496
match to group clients set large-community delete 64496:102:0

# prepend_twice_to_peer
match to group clients set community delete 65512:*
match to group clients set large-community delete 64496:102:*

# reject_cause
match to group clients set community delete 65520:*
match to group clients set large-community delete 64496:65520:*

# reject_cause_map_1
match to group clients set large-community delete 64496:1101:5

# reject_cause_map_10
match to group clients set large-community delete 64496:1101:3

# reject_cause_map_12
match to group clients set large-community delete 64496:1101:9

# reject_cause_map_14
match to group clients set large-community delete 64496:1101:13

# reject_cause_map_2
match to group clients set large-community delete 64496:1101:3

# reject_cause_map_5
match to group clients set large-community delete 64496:1101:8

# reject_cause_map_6
match to group clients set large-community delete 64496:1101:7

# reject_cause_map_7
match to group clients set large-community delete 64496:1101:4

# reject_cause_map_8
match to group clients set large-community delete 64496:1101:14

# reject_cause_map_9
match to group clients set large-community delete 64496:1101:10

# rpki_bgp_origin_validation_invalid
match to group clients set community delete 64512:53
match to group clients set large-community delete 64496:1000:4

# rpki_bgp_origin_validation_unknown
match to group clients set community delete 64512:52
match to group clients set large-community delete 64496:1000:2

# rpki_bgp_origin_validation_valid
match to group clients set community delete 64512:51
match to group clients set large-community delete 64496:1000:1


# Scrub prepending communities
match to group clients set {
	community delete 65501:64496
	large-community delete 64496:101:0

}
match to group clients set {
	community delete 65511:*
	large-community delete 64496:101:*

}
match to group clients set {
	community delete 65503:64496
	large-community delete 64496:103:0

}
match to group clients set {
	community delete 65513:*
	large-community delete 64496:103:*

}
match to group clients set {
	community delete 65502:64496
	large-community delete 64496:102:0

}
match to group clients set {
	community delete 65512:*
	large-community delete 64496:102:*

}


# RFC1997 NO_EXPORT/NO_ADVERTISE received from clients and propagated because of pass-through policy
match to group clients ext-community $INTCOMM_NO_EXPORT set community NO_EXPORT
match to group clients ext-community $INTCOMM_NO_ADVERTISE set community NO_ADVERTISE

# Remove internal communities before announcing the route
match to group clients set {
	ext-community delete $INTCOMM_PREF_OK_ROA
	ext-community delete $INTCOMM_ROUTE_OK_WL
	ext-community delete $INTCOMM_PREF_OK_ARINDB
	ext-community delete $INTCOMM_PREF_OK_REGISTROBRDB
	ext-community delete $INTCOMM_ORIGIN_OK
	ext-community delete $INTCOMM_ORIGIN_KO
	ext-community delete $INTCOMM_PREFIX_OK
	ext-community delete $INTCOMM_PREFIX_KO
	ext-community delete $INTCOMM_IRR_REJECT
	ext-community delete $INTCOMM_RPKI_UNKNOWN
	ext-community delete $INTCOMM_RPKI_INVALID
	ext-community delete $INTCOMM_RPKI_VALID
	ext-community delete $INTCOMM_NO_EXPORT
	ext-community delete $INTCOMM_NO_ADVERTISE
	ext-community delete $INTCOMM_PROCESS_PREPEND_COMMS

}


